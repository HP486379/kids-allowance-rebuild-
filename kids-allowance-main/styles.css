:root{
  --bg:#fff8fb;
  --card:#ffffff;
  --ink:#222;
  --muted:#6a6a6a;
  --brand:#ff4fb3;
  --brand-2:#7c5cff;
  --good:#00c27a;
  --bad:#ff5a67;
  --grad-card-a:#ffd6ea;
  --grad-card-b:#eae6ff;
  --ring: 0 0 0 2px #0000000d, 0 6px 20px #0000001a;
  --radius:16px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
  background: radial-gradient(1200px 600px at -20% -10%, #ffe3f1, transparent),
              radial-gradient(800px 400px at 120% -20%, #e6e1ff, transparent),
              var(--bg);
  color:var(--ink);
}

/* Theme: Adventure (blue/teal) */
body.theme-adventure{
  --bg:#f6fbff;
  --brand:#2f88ff;
  --brand-2:#00c2ff;
  --grad-card-a:#d6eeff;
  --grad-card-b:#d0fff2;
  --good:#00b884;
  --bad:#ff5a67;
  background:
    radial-gradient(1100px 600px at -20% -10%, #d6eeff, transparent),
    radial-gradient(900px 500px at 120% -20%, #d0fff2, transparent),
    var(--bg);
}

.app{ max-width:980px; margin:0 auto; padding:16px; }

.app-header{ display:flex; flex-wrap:wrap; gap:16px; align-items:stretch; margin-bottom:12px; }
.profile{ display:flex; align-items:center; gap:12px; padding:12px 14px; background:var(--card); border-radius:var(--radius); box-shadow:var(--ring); }
.avatar{ font-size:32px; width:56px; height:56px; border-radius:50%; border:none; background:#fff3; cursor:pointer; transition: transform .1s; }
.avatar:active{ transform: scale(.96); }
.name-wrap{ display:flex; flex-direction:column; }
.child-name{ font-size:18px; border:none; background:transparent; padding:4px 6px; border-radius:8px; width:180px; }
.child-name:focus{ outline:2px solid #0002; background:#fff; }
.greeting{ font-size:12px; color:var(--muted); }

.balance-card{ flex:1 1 280px; min-width:260px; display:grid; place-items:center; gap:4px; padding:12px; background:linear-gradient(135deg, var(--grad-card-a), var(--grad-card-b)); border-radius:var(--radius); box-shadow:var(--ring); position:relative; overflow:hidden; }
.balance-label{ font-size:14px; color:#7c3e64 }
.balance{ font-size:40px; font-weight:900; letter-spacing:.5px; color:#5a2b70; text-shadow:0 1px 0 #fff6; }
.piggy-wrap{ position:absolute; right:12px; bottom:8px; }
/* Minecraft-like isometric piggy bank (more detailed) */
.piggy{ width:170px; height:108px; position:relative; image-rendering: pixelated; }
.piggy > span{ position:absolute; display:block; }
.piggy{ --p1:#f7b6c2; --p2:#f3a2af; --p3:#ea96a6; --p4:#d57f8d; --hoof:#6a3a33; --eye:#1a1618; --white:#fff; }

/* top plane */
.piggy .top{
  left:46px; top:16px; width:112px; height:24px;
  clip-path: polygon(8% 60%, 86% 0, 100% 40%, 22% 100%);
  background:
    /* slot */ linear-gradient(#0008, #0008) 56px 6px/34px 4px no-repeat,
    /* pixel noise */
    linear-gradient(90deg, #0000 0 50%, #ffffff14 50% 100%) 0 0/8px 8px repeat,
    linear-gradient(0deg, #0000 0 50%, #ffffff10 50% 100%) 0 0/8px 8px repeat,
    linear-gradient(135deg, var(--p1), var(--p2));
  border:1px solid #e195a4; box-shadow: inset -10px -8px 0 #0000000a, 0 1px 0 #0001;
  z-index:2;
}

/* body side */
.piggy .body{
  left:44px; top:28px; width:116px; height:66px;
  clip-path: polygon(6% 12%, 98% 0%, 98% 82%, 6% 96%);
  background:
    /* patches */
    linear-gradient(90deg, #0000 0 50%, #ffffff10 50% 100%) 0 0/8px 8px repeat,
    linear-gradient(0deg, #0000 0 50%, #ffffff0e 50% 100%) 0 0/8px 8px repeat,
    linear-gradient(135deg, var(--p2) 15%, var(--p3) 100%);
  border:1px solid #e195a4; box-shadow: inset -14px -12px 0 #0000000a, 0 2px 0 #0001;
  z-index:1;
}

/* head side */
.piggy .head{
  left:8px; top:34px; width:60px; height:50px;
  clip-path: polygon(6% 14%, 100% 0%, 100% 76%, 6% 90%);
  background:
    /* eyes (white + pupil toward内側) */
    linear-gradient(var(--white), var(--white)) 10px 18px/14px 10px no-repeat,
    linear-gradient(var(--eye), var(--eye)) 18px 18px/6px 10px no-repeat,
    linear-gradient(var(--white), var(--white)) 30px 20px/14px 10px no-repeat,
    linear-gradient(var(--eye), var(--eye)) 30px 20px/6px 10px no-repeat,
    /* pixel texture */
    linear-gradient(90deg, #0000 0 50%, #ffffff10 50% 100%) 0 0/8px 8px repeat,
    linear-gradient(0deg, #0000 0 50%, #ffffff0e 50% 100%) 0 0/8px 8px repeat,
    linear-gradient(135deg, var(--p2) 15%, var(--p3) 100%);
  border:1px solid #e195a4; box-shadow: inset -10px -10px 0 #0000000a, 0 2px 0 #0001;
  z-index:3;
}

/* snout block protruding */
.piggy .snout{
  left:-8px; top:44px; width:34px; height:22px;
  clip-path: polygon(10% 20%, 100% 0%, 100% 80%, 10% 100%);
  background:
    linear-gradient(var(--p3), var(--p3)) 10px 8px/18px 10px no-repeat,
    linear-gradient(#c57786, #c57786) 14px 12px/4px 4px no-repeat,
    linear-gradient(#c57786, #c57786) 22px 13px/4px 4px no-repeat,
    linear-gradient(135deg, var(--p3), var(--p4));
  border:1px solid #e195a4; box-shadow: inset -8px -6px 0 #00000010;
  z-index:4;
}

/* ears */
.piggy .ear{ width:14px; height:10px; clip-path: polygon(0 60%, 90% 0, 100% 30%, 10% 90%);
  background: linear-gradient(135deg, var(--p1), var(--p2)); border:1px solid #e195a4; box-shadow: inset -4px -3px 0 #0000000a; }
.piggy .ear.e1{ left:18px; top:26px; z-index:4 }
.piggy .ear.e2{ left:38px; top:22px; z-index:3 }

/* legs (4) */
.piggy .leg{ width:20px; height:20px; background:
    linear-gradient(#0000 0 70%, #00000010 0 100%) 0 0/100% 100% no-repeat,
    linear-gradient(var(--p3), var(--p3));
  border:1px solid #e195a4; box-shadow: inset 0 -6px 0 #00000010; clip-path: polygon(6% 10%, 96% 0, 96% 90%, 6% 100%);
}
.piggy .leg::after{ content:""; position:absolute; left:0; right:0; bottom:0; height:7px; background: var(--hoof); }
.piggy .l1{ left:58px; top:82px; z-index:0 }
.piggy .l2{ left:86px; top:86px; z-index:0 }
.piggy .l3{ left:114px; top:84px; z-index:0 }
.piggy .l4{ left:42px; top:86px; z-index:0 }

.tabs{ display:flex; gap:8px; margin:10px 0 6px; }
.tab{ flex:1; padding:10px 8px; background:var(--card); border:0; border-radius:999px; box-shadow:var(--ring); cursor:pointer; font-weight:700; color:#5b587a }
.tab.active{ background:linear-gradient(135deg, var(--grad-card-a), var(--grad-card-b)); color:#3a2a60 }

.views{ display:block; }
.view{ display:none; }
.view.active{ display:block; }

.cards-grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:12px; }
.card{ background:var(--card); border-radius:var(--radius); box-shadow:0 0 0 2px #0000000d, 0 6px 18px #00000018; padding:12px; }
.card-title{ font-weight:800; color:#4b2b79; margin-bottom:8px; }

.toolbar{ display:flex; gap:8px; align-items:center; justify-content:space-between; margin:8px 0; }

.list{ list-style:none; margin:0; padding:0; }
.list li{ display:flex; align-items:center; justify-content:space-between; padding:10px; border-radius:12px; background:#fff; box-shadow:0 1px 0 #0000000d; margin-bottom:8px; }
.list .meta{ font-size:12px; color:var(--muted) }
.list .note{ color:#5a2b70; font-weight:700 }

.recent-list li{ gap:8px; }

.tx-list .amount{ font-weight:900 }
.tx-list .amount.good{ color:var(--good) }
.tx-list .amount.bad{ color:var(--bad) }

.chore-list button{ border:0; padding:8px 10px; border-radius:999px; background:linear-gradient(135deg, #c6ffd9, #a8ffe7); color:#064; font-weight:800; box-shadow:var(--ring); cursor:pointer }
.chore-list li.done{ opacity:.6 }

.goals{ display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:12px }
.goal-card{ display:grid; grid-template-columns: 74px 1fr; gap:10px; align-items:center; background:var(--card); border-radius:var(--radius); box-shadow:0 0 0 2px #0000000d, 0 6px 18px #00000018; padding:12px }
.ring{ width:74px; height:74px; border-radius:50%; background:conic-gradient(var(--brand) 0 0, #eee 0 100%); display:grid; place-items:center; font-weight:900; color:#4b2b79 }
.ring .inner{ width:56px; height:56px; border-radius:50%; background:#fff }
.goal-name{ font-weight:800; color:#4b2b79 }
.goal-actions{ display:flex; gap:8px; margin-top:6px }

.btn{ border:0; padding:10px 12px; background:#f3f3f6; border-radius:12px; cursor:pointer; font-weight:800; box-shadow:0 0 0 2px #0000000d, 0 4px 12px #00000014 }
.btn.primary{ background:linear-gradient(135deg, var(--grad-card-a), var(--grad-card-b)); color:#3a2a60 }
.btn.good, .btn.btn-good{ background:linear-gradient(135deg, #c6ffd9, #a8ffe7); color:#064 }
.btn.bad, .btn.btn-bad{ background:linear-gradient(135deg, #ffd6d6, #ffe0e0); color:#631 }
.btn.danger{ background:linear-gradient(135deg, #ffd6d6, #ffb3b3); color:#7a1122 }
.btn:active{ transform: translateY(1px); }

.input{ padding:10px 12px; border-radius:12px; border:1px solid #e8e8ee; background:#fff; box-shadow:inset 0 1px 0 #00000008 }
.form-inline{ display:flex; gap:8px; flex-wrap:wrap }
.form .field{ display:grid; gap:6px; margin-bottom:10px }
.field-row{ display:flex; gap:10px; align-items:center; margin:8px 0 }

.dialog{ border:none; border-radius:16px; padding:0; box-shadow: 0 30px 100px #0003; }
.dialog::backdrop{ background:#0006 }
.dialog .form{ padding:14px; min-width:280px; }
.dialog-actions{ display:flex; gap:8px; justify-content:flex-end }

/* Dialog fallback for browsers without <dialog> */
body.modal-open::after{ content:""; position:fixed; inset:0; background:#0006; z-index:1000; }
.dialog.open{ display:block; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); z-index:1001; background:#fff; }
.dialog.open .form{ min-width:300px; }

/* Coin animations */
.coin{ position:fixed; width:26px; height:26px; border-radius:50%; background: radial-gradient(circle at 30% 30%, #fff8, #0000),
  linear-gradient(145deg, #ffd84e, #ffb433); box-shadow:0 2px 0 #d08b00, inset 0 0 0 2px #ffeb96; z-index:1000; animation: drop 800ms ease-in forwards; }
@keyframes drop{ 0%{ transform: translateY(-40vh) scale(.7); opacity:.6 } 70%{ transform: translateY(0) scale(1.05) } 85%{ transform: translateY(-10px) scale(1) } 100%{ transform: translateY(0) } }

/* Confetti */
.confetti{ position:fixed; inset:0; pointer-events:none; overflow:hidden; }
.confetti .p{ position:absolute; width:8px; height:14px; opacity:.9; animation: fall 1200ms ease-out forwards; }
@keyframes fall{ from{ transform: translateY(-20vh) rotate(0) } to{ transform: translateY(100vh) rotate(540deg) } }

/* Responsive */
@media (max-width:540px){
  .balance{ font-size:32px }
  .avatar{ width:48px; height:48px; font-size:28px }
}

/* Focus visibility for controller/keyboard */
button:focus-visible, .tab:focus-visible, .btn:focus-visible, input:focus-visible, select:focus-visible, textarea:focus-visible{
  outline:3px solid var(--brand-2); outline-offset:2px;
}

/* Larger tap targets for settings rows on small screens */
.field-row label{ min-width:84px; color:#555 }
textarea.input, .textarea{ padding:10px 12px; border-radius:12px; border:1px solid #e8e8ee; background:#fff; width:100%; min-height:120px; box-shadow:inset 0 1px 0 #00000008 }
